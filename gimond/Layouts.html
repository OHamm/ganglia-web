<!DOCTYPE html>
<html>

   <head>
      <script type="text/javascript" src="jquery-1.9.1.min.js"></script>
   </head>

   <body>
      <h2>Testing metrics</h2>
      <buttons>
      <button type="button" id="update" value="Update" onclick="updateMetrics()">Update</button>
      <label><input type="checkbox" id="autoUpdateCheck">Auto Update</label>
      <label><input type="number" id="interval"/>Interval(ms)</label>
      </buttons>

      <span id="metrics"></span>

      <script>
      var timerId;
      //TODO add graphs && table
         function checkAutoUpdate(){
            //?? document.addEventListener(); ??
            return !document.getElementById("autoUpdateCheck").checked && document.getElementById("update").value == "Update";
         }

         function retrieveInterval(){
            var val = document.getElementById("interval").value;
            if(isNaN(val)){
               alert("This isn't a number");
               return 0;
            }else if(val <= 0){
               alert("Interval should be > 0");
               return 0;
            }else{
               return val;
            }
         }

         function autoUpdateMetrics(){
            if(document.getElementById("update").value == "Update"){
               var val = retrieveInterval();
               if(val != 0){
                  document.getElementById("update").value = "Stop";
                  $('#update').text("Stop");
                  timerId = setInterval(updateM, val)
               }
            }else{
               document.getElementById("update").value = "Update";
               $('#update').text("Update");
               clearTimeout(timerId);
            }
         }

         function updateMetrics(){
            if(checkAutoUpdate()){
               updateM();
            }else{
               autoUpdateMetrics();
            }
         }
         //This is just here for testing purposes so I don't forget something while I code...
         function testingfun(txt){
            alert(txt);
         }

         function updateM(){
            var Gmetad = "http://localhost:8652/status";
            $.ajax({
            url: Gmetad,
            dataType: "jsonp",
            contentType: "application/json",
            jsonpCallback: "jsonCallback",
            });
         };
         //This will be changed
         function jsonCallback(data){
            $.each(data, function(key, val) {
               if(key == "metrics" || key == "core" || key == "cpu" ||
               key == "disk" || key == "load" || key == "memory" ||
               key == "network" || key == "process" || key == "system" ||
               key == "other" || key == "received" || key == "sent"){
                  $('#metrics').append('<p>' + key + ':</p>')
                  jsonCallback(val);
               }else{
                  $('#metrics').append('<p>' + key + ': ' + val + '</p>')
               }
            });
         }
      </script>
   </body>

</html>